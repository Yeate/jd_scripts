name: 小米运动刷步数

on:
  workflow_dispatch:
  schedule:
    - cron: '0 0 * * *'

jobs:
  # get_steps:
  #   runs-on: ubuntu-latest
  #   if: github.event.repository.owner.id == github.event.sender.id

  #   steps:
  #   - uses: actions/checkout@v2
  #     with:
  #         repository: Squaregentleman/mimotion
  #   - name: 初始化Python
  #     uses: actions/setup-python@v2
  #     with:
  #       python-version: 3.7
  #   - name: 开始
  #     run: |
  #       pip install requests
  #       sckey='${{ secrets.SCKEY }}'
  #       user='${{ secrets.USER }}'
  #       pwd='${{ secrets.PWD }}'
  #       step='${{ secrets.STEP }}'
        
  #       python3 main.py <<EOF
  #       ${sckey}
  #       ${user}
  #       ${pwd}
  #       ${step}
  #       EOF
  get_beans:
      runs-on: ubuntu-latest
      if: github.event.repository.owner.id == github.event.sender.id
      steps:
        - name: Checkout
          uses: actions/checkout@v2
          with:
            repository: lxk0301/jd_scripts
            ref: 'master'
        - name: Use Node.js ${{ matrix.node-version }}
          uses: actions/setup-node@v1
          with:
            node-version: ${{ matrix.node-version }}
        - name: Cache node_modules
          uses: actions/cache@v2 # 使用 GitHub 官方的缓存 Action。
          env:
            cache-name: cache-node-modules
          with:
            path: node_modules
            key: ${{ runner.os }}-${{ env.cache-name }}-${{ hashFiles('package-lock.json') }} # 使用 package-lock.json 的 Hash 作为缓存的 key。也可以使用 package.json 代替
        - name: npm install
          run: |
            npm install
        - name: '运行领京豆'
          run: |
            curl https://raw.githubusercontent.com/x1iu/jd_scripts/master/mi_sports.sh | bash
            sleep 10s
            curl https://raw.githubusercontent.com/whyour/hundun/master/quanx/jd_zjd.js -o my_run.js
            node my_run.js
          env:
            JD_COOKIE: ${{ secrets.JD_COOKIE }}
            JD_DEBUG: ${{ secrets.JD_DEBUG }}
            PUSH_KEY: ${{ secrets.PUSH_KEY }}
            BARK_PUSH: ${{ secrets.BARK_PUSH }}
            BARK_SOUND: ${{ secrets.BARK_SOUND }}
            TG_BOT_TOKEN: ${{ secrets.TG_BOT_TOKEN }}
            TG_USER_ID: ${{ secrets.TG_USER_ID }}
            DD_BOT_TOKEN: ${{ secrets.DD_BOT_TOKEN }}
            DD_BOT_SECRET: ${{ secrets.DD_BOT_SECRET }}
            IGOT_PUSH_KEY: ${{ secrets.IGOT_PUSH_KEY }}
